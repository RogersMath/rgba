<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>[RGBA] Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- This overlay is crucial for initializing audio on user interaction -->
    <div id="startOverlay">
        <div id="startMessage">Click to Begin</div>
    </div>

    <div id="gameContainer">
        <canvas id="glslCanvas"></canvas>
        
        <div id="gameUI">
            <!-- Top Bar -->
            <div id="topBar">
                <div id="scoreTime">Score: <span id="score">0</span> | Time: <span id="time">0:00</span></div>
                <div id="rank">APPRENTICE</div>
                <button id="menuBtn">☰</button>
            </div>
            
            <!-- Objective Display -->
            <div id="objective">
                <div id="objectiveFunction">f(R,G,B) = <span id="rCoeff">0.33</span>×R + <span id="gCoeff">0.33</span>×G + <span id="bCoeff">0.33</span>×B</div>
                <div id="constraints">
                    <span>R: <span id="rMin">3.5</span>-<span id="rMax">20.5</span></span>
                    <span>G: <span id="gMin">3.5</span>-<span id="gMax">20.5</span></span>
                    <span>B: <span id="bMin">3.5</span>-<span id="bMax">20.5</span></span>
                    <span>A: <span id="aVal">0</span></span>
                </div>
            </div>
            
            <!-- Cards Area -->
            <div id="cardsArea">
                <div class="card" data-card="0">
                    <div class="card-equation" id="equation0">?</div>
                    <div class="card-effects" id="effects0">?</div>
                </div>
                <div class="card" data-card="1">
                    <div class="card-equation" id="equation1">?</div>
                    <div class="card-effects" id="effects1">?</div>
                </div>
                <div class="card" data-card="2">
                    <div class="card-equation" id="equation2">?</div>
                    <div class="card-effects" id="effects2">?</div>
                </div>
            </div>
            
            <!-- Current Status -->
            <div id="currentRGB">
                Current: R=<span id="currentR">12</span> G=<span id="currentG">15</span> B=<span id="currentB">8</span> | Value: <span id="currentValue">11.65</span>
            </div>
            
            <!-- Numpad -->
            <div id="numpad">
                <button class="numpad-btn" data-num="7">7</button>
                <button class="numpad-btn" data-num="8">8</button>
                <button class="numpad-btn" data-num="9">9</button>
                <button class="numpad-btn" data-num="4">4</button>
                <button class="numpad-btn" data-num="5">5</button>
                <button class="numpad-btn" data-num="6">6</button>
                <button class="numpad-btn" data-num="1">1</button>
                <button class="numpad-btn" data-num="2">2</button>
                <button class="numpad-btn" data-num="3">3</button>
            </div>
        </div>
        
        <!-- Settings Overlay -->
        <div id="settingsOverlay">
            <div id="settingsContent">
                <h2>Game Paused</h2>
                <!-- Volume Slider for Audio -->
                <div class="setting-item">
                    <label for="volumeSlider">Volume</label>
                    <input type="range" min="0" max="100" value="30" class="slider" id="volumeSlider">
                </div>
                <label id="accessibilityToggle">
                    <input type="checkbox" id="accessibilityCheckbox">
                    Visually Impaired Mode
                </label>
                <hr>
                <p>Problems Solved: <span id="statProblems">0</span></p>
                <p>Time This Run: <span id="statTime">0:00</span></p>
                <p>Best Score: <span id="statBest">0</span></p>
                <p>Current Rank: <span id="statRank">APPRENTICE</span></p>
            </div>
            <button id="closeSettings">Resume Game</button>
        </div>
    </div>

    <!-- Shader script remains in HTML for simplicity as requested -->
    <script id="shader-script">
        // This script block is intentionally left minimal. It just sets up WebGL variables.
        // The render loop that uses them is in js/main.js
        const canvas = document.getElementById('glslCanvas');
        const gl = canvas.getContext('webgl');
        if (!gl) { alert('WebGL not supported!'); }
        const vertexShaderSource=`attribute vec2 a_position;void main(){gl_Position=vec4(a_position,0.,1.);}`;
        const fragmentShaderSource=`precision highp float;uniform vec2 iResolution;uniform float iTime;#define RESOLUTION iResolution;#define TIME iTime;#define MAX_MARCHES 30;#define TOLERANCE 1e-4;mat2 ROT(float a){float s=sin(a),c=cos(a);return mat2(c,s,-s,c);}mat2 g_rot0,g_rot1;vec3 sRGB(vec3 c){return pow(c,vec3(1./2.2));}const vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 hsv2rgb(vec3 c){vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}float apolloian(vec3 p,float s,out float h){float scale=1.;for(int i=0;i<5;++i){p=-1.+2.*fract(.5*p+.5);float r2=dot(p,p);float k=s/r2;p*=k;scale*=k;}vec3 ap=abs(p/scale);float d=min(length(ap.xy),ap.z);h=(d==ap.z)?.5:0.;return d;}float df(vec2 p,out float h){vec3 p3=vec3(p,.1);p3.xz*=g_rot0;p3.yz*=g_rot1;return apolloian(p3,1.,h)*1.55;}float shadow(vec2 p,vec2 ld,float mint,float maxt){float res=1.,t=mint,h;for(int i=0;i<MAX_MARCHES;++i){float d=df(p+ld*t,h);if(d<TOLERANCE)return 0.;res=min(res,8.*d/t);t+=d*.6;}return res;}vec3 effect(vec2 p){float a=.1*TIME;g_rot0=ROT(.5*a);g_rot1=ROT(sqrt(.5)*a);vec2 lightPos=vec2(0.,1.)*g_rot1;vec2 ld=normalize(lightPos-p);float h;float d=df(p,h);vec3 bcol=hsv2rgb(vec3(fract(h-.2*length(p)+.25*TIME),.666,1.));float sh=shadow(p,ld,.05,length(lightPos-p));vec3 col=bcol*sh*max(0.,dot(vec3(ld,1.),vec3(0.,0.,-1.)));col+=exp(-300.*abs(d))*sqrt(bcol);return col;}void main(){vec2 q=gl_FragCoord.xy/RESOLUTION.xy;vec2 p=-1.+2.*q;p.x*=RESOLUTION.x/RESOLUTION.y;vec3 col=effect(p);col*=smoothstep(0.,4.,TIME);gl_FragColor=vec4(sRGB(col),1.);}`;
        function createShader(gl,type,src){const s=gl.createShader(type);gl.shaderSource(s,src);gl.compileShader(s);if(gl.getShaderParameter(s,gl.COMPILE_STATUS))return s;console.error(gl.getShaderInfoLog(s));gl.deleteShader(s);}
        function createProgram(gl,vs,fs){const p=gl.createProgram();gl.attachShader(p,vs);gl.attachShader(p,fs);gl.linkProgram(p);if(gl.getProgramParameter(p,gl.LINK_STATUS))return p;console.error(gl.getProgramInfoLog(p));gl.deleteProgram(p);}
        const vertexShader=createShader(gl,gl.VERTEX_SHADER,vertexShaderSource),fragmentShader=createShader(gl,gl.FRAGMENT_SHADER,fragmentShaderSource),program=createProgram(gl,vertexShader,fragmentShader),positionAttributeLocation=gl.getAttribLocation(program,"a_position"),resolutionUniformLocation=gl.getUniformLocation(program,"iResolution"),timeUniformLocation=gl.getUniformLocation(program,"iTime"),positionBuffer=gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),gl.STATIC_DRAW);
        gl.useProgram(program);gl.enableVertexAttribArray(positionAttributeLocation);gl.bindBuffer(gl.ARRAY_BUFFER,positionBuffer);gl.vertexAttribPointer(positionAttributeLocation,2,gl.FLOAT,!1,0,0);
    </script>
    
    <!-- Game and Audio Scripts -->
    <script src="js/sonantx.js"></script>
    <script src="js/audio.js" type="module"></script>
    <script src="js/main.js" type="module"></script>
</body>
</html>
